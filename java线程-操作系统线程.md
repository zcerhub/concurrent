## 进程

定义：是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位。

## 线程

定义：操作系统进行计算调度的基本单位。

### 实现方式

- 用户级线程

  有关线程管理（线程的创建、撤销和切换等）的所有工作都由应用程序完成。

- 内核级线程

  线程管理的所有工作由内核完成，应用程序没有进行线程管理的代码，只有一个到内核级线程的编程接口。内核为进程及其内部的每个线程维护上下文信息，调度以及切换也是由内核完成

### 多线程模型

- 多对一模型

  将多个用户线程映射到一个内核级线程，线程管理在用户空间完成。用户线程对操作系统不可见。

  - 优点：线程管理在用户空间进行，效率较高
  - 缺点：一个线程在使用内核服务时被阻塞，整个进程都被阻塞；多个线程不能并行的运行在多处理机上

- 一对一模型

  将每个用户级线程映射到一个内核线程

  - 优点：当一个线程被阻塞后，允许另一个线程继续运行，并发能力较强
  - 缺点：每创建一个用户级线程都需要创建一个内核级线程与之对应，创建线程的开销较大

- 多对多模型

  将n个用户级线程映射到m哥内核级线程上，要求n>m

  特点：克服了多对一模型并发度不高的缺点，有克服了一对一模型中线程创建开销较大的缺点。



## 比较

- 系统开销：创建和撤销进程时，系统需要为之分配或回收资源，如内存空间、I/O设备等，因此操作系统所付出的开销远大于创建或撤销线程的开销。在进行进程切换时，涉及当前执行进程CPU环境的保存及新调度到进程CPU环境的设置，而线程切换时只需保持和设置少量寄存器内容，开销很小。
- 通信方面：进程间通信需要进程同步和互斥手段的辅助，以保证数据的一致性，而线程间可以直接读/写进程数据段（如全局变量）来进行通信。

- 拥有资源：线程是独立调度的基本单元，进程是资源分配的基本单元。

  

### java中的线程

#### green Thread

定义：一种由运行环境或虚拟机调度的线程，在用户空间模拟多线程的运行。

在java1.1中，绿色线程（在solaris上）是JVM中唯一使用的线程模型。

优点：

- 用户态到内核态的切换在用户空间完成，系统开销较小

缺点：

- 如果某个线程发生阻塞，会导致所有的线程都阻塞。

### native thread

在java1.2之后，linux中的jvm是基于pthread实现的。所以java中的线程就是操作系统的线程，关系是1:1。



## 进程及其线程的状态

### 进程的状态

![1636286189372](D:\学习\儒猿-并发学习\assets\1636286189372.png)

状态说明：

- ready：就绪状态，等待被调度
- running：正在运行
- waiting：等待资源

注意：

- 只有就绪态和运行态之间可以相互转化，其它的都是单向的。就绪状态通过调度算法获得cpu变为运行态，运行态由于分配给进程的cpu时间用完转为就绪态
- 阻塞态是由于缺少资源从运行态转化而来的，但是该资源不包括cpu。

### java中线程状态极其转化

![1636287477165](D:\学习\儒猿-并发学习\assets\1636287477165.png)

- new状态：创建后尚未启动的线程处于这种状态

- running：包含了操作系统中的ready和running。处于该状态的线程可能正在运行，也可能等待cpu的时间片

- waiting：无限期等待。处于该状态的线程不会被cpu分配时间片，它们需要其它线程通过notify或notifyAll唤醒。

  进行该状态的方法：

  - 调用object.wait方法
  - 调用Thread.join方法
  - LockSupport.park方法

- timed waiting：有限等待。处于该状态的线程不会被cpu分配时间片，可以不需要其它线程的显示唤醒，在一定时间后会自动唤醒。

  进行该状态的方法：

  - Thread.sleep()
  - Object.wait(long timeout)
  - LockSupport.parkNanos(long nanos)或者LockSupport.parkUntil(long deadline)



参考文献：

- [进程](https://baike.baidu.com/item/%E8%BF%9B%E7%A8%8B/382503)
- 王道考研
- [java中的线程-从源码尝试解答](https://zhuanlan.zhihu.com/p/133275094)
- [操作系统的线程和java中的线程](https://os.51cto.com/art/202101/641015.htm)